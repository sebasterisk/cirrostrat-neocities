<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>your schedulizer</title>
</head>
<body>
    <h1>schedulizer</h1>
    <hr>
    <span id="errors"></span>
    <span id="timenow"></span>
    
    <script>
        const timenow = document.getElementById("timenow")
        setInterval(function(){
            timenow.innerHTML = new Date().toLocaleTimeString()
        })
    </script>

    <select name="type" id="type">
        <option value="" selected disabled hidden>select schedule type</option>
        <option value="default">default</option>
        <!--
        <option value="wed">wed</option>
        <option value="mass">mass</option>
        <option value="forum">forum</option>
        <option value="earlydis">early dismissal</option>
        <option value="latestart">delayed start</option>
        <option value="anchor">anchor</option>
        -->
    </select>

    <select name="day" id="day" hidden>
    </select>

    <br>
    <span id="selected"></span>

    <script>
        if (window.location.search == "") {
            console.error("no data in searchparams!")
            const errtext = document.getElementById("errors")
            errtext.innerHTML = "No data. Head to <a href='/creations/schedulizer/index.html'>home page</a> for setup.<br>"
        }

        const here = window.location.href,
              thisurl = new URL(here),
              params = thisurl.searchParams,
              data = params.get("data"),
              complete = JSON.parse(data)

        const type = document.getElementById("type")
        const day = document.getElementById("day")
        const selected = document.getElementById("selected")

        let fetchres

        function getjson(){
            fetch('/creations/schedulizer/schedule.json')
                .then((response) => response.json())
                .then((json) => {fetchres = json})
        }

        function update(){
            let val = type.value
            let keys = Object.keys( fetchres[val].attr.sets )
            console.log(keys)

            for(i in keys){
                day.add(new Option(keys[i], keys[i]))
            }
            day.removeAttribute("hidden")
        }
        getjson()
        type.onchange = update
        
    </script>
</body>
</html>